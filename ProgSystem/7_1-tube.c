/* 
 * Auteur(s): ZHEN Cheng
 *
*/

#include<stdio.h>   
#include <sys/wait.h>
#include<string.h>  
#include<stdlib.h>
#include <unistd.h>  
  
#define BUFSIZE PIPE_BUF

void err_quit(char *err) {  
        printf("%s\n",err);  
        exit(-1);  
}  
  
int main(int argc, char **argv) {  
  int fd[2];  
  char buf_pere;
  char buf_fils;  
  pid_t pid;  

  if (pipe(fd) < 0) {  
    err_quit("pipe error");  
  }  
  if ((pid = fork()) < 0) {  
    err_quit("fork error");  
  } else if(pid > 0) {  /* Processus pere */ 
    close(fd[0]);  /* Fermeture de lecture de pere */
    while (read(STDIN_FILENO, &buf_pere, 1) > 0) {  /* Le pere lit le fichier standard d'entree par la clavier */
      write(fd[1], &buf_pere, 1);  /* Le pere ecrit dans le tube ce qu'il a lu */
    }  
    wait(NULL);
    exit(0);
  } else {  /* Processus fils */
    close(fd[1]);  /* Fermeture d'ecriture de fils */
    while (read(fd[0], &buf_fils, 1) > 0) { /* Le fils lit ce que le pere a ecrit dans le tube */
      write(STDOUT_FILENO, &buf_fils, 1);  /* Le fils ecrit ce qu'il a lu */
    }
	  exit(0);
  }
    
  return 0;  
}  

